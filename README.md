# Smart_Menu_Test

Небольшой Django‑проект Smart_Menu_Test, демонстрирующий древовидное меню, которое:

- хранится в БД и управляется через стандартную админку;
- отрисовывается тегом `{% draw_menu 'menu_slug' %}` без сторонних библиотек;
- раскрывает активную ветку целиком и первый уровень потомков выделенного пункта;
- поддерживает явные и именованные URL и гарантирует 1 SQL‑запрос на меню.

## Требования

- Python 3.11+
- Django 5.0.2 (устанавливается в виртуальное окружение)

## Быстрый старт

```bash
python -m venv .venv
.venv\Scripts\activate         # Windows PowerShell
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

После запуска проект доступен на `http://127.0.0.1:8000/`. В базовом шаблоне меню уже выводится через `{% draw_menu 'main_menu' %}`.

### Переменные окружения

Используется `pydantic-settings`, поэтому нужные параметры задаются через `.env`
(лежит в корне проекта) или переменные окружения с префиксом `DJANGO_`. Создайте файл `.env`
со содержимым вида:

```
DJANGO_SECRET_KEY=please-change-me
DJANGO_DEBUG=True
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1
DJANGO_DB_NAME=db.sqlite3
```

Доступные ключи:

- `DJANGO_SECRET_KEY`
- `DJANGO_DEBUG` (`True/False`)
- `DJANGO_ALLOWED_HOSTS` (список, разделённый запятой)
- `DJANGO_DB_NAME` (имя sqlite-файла, по умолчанию `db.sqlite3`)

## Настройка меню

После миграций уже создано меню `main_menu` с корневыми пунктами («Главная», «Документация», «Тарифы», «Контакты») и вложенными разделами документации. Вы можете сразу перейти на `/` и покликать готовую структуру.

Чтобы изменить пример или добавить своё меню:

1. Зайдите в `/admin/` и отредактируйте существующий объект `Menu` или добавьте новый.
2. Через инлайны добавьте/измените пункты. Для каждой записи укажите:
   - **Явный URL** (например, `/contacts/`) или **Named URL** (например, `contacts`);
   - Родителя (если это вложенный пункт);
   - Порядок отображения.
3. В нужном шаблоне подключите `{% load menu_tags %}` и вызовите тег:

```django
{% load menu_tags %}
...
{% draw_menu 'main_menu' %}
```

Тег выполняет один запрос к БД, кеширует данные внутри текущего запроса и сам решает, что раскрывать.

## Что увидите на главной

После запуска `runserver` и перехода на `http://127.0.0.1:8000/` откроется демо-экран с градиентным hero-блоком, плиткой живого меню и карточкой-инструкцией, как заполнить древовидную структуру через админку. Активная ветка меню подсвечивается автоматически, пустое меню предлагает перейти в `/admin/` и добавить пункты.

## Тесты

```bash
python manage.py test menus
```

Тесты проверяют:

- отсутствие дополнительных запросов при повторном рендере меню;
- корректное вычисление активной ветки и раскрытие потомков;
- единичный SQL‑запрос на построение контекста меню.

## Структура

- `menus/models.py` – модели `Menu` и `MenuItem`;
- `menus/services.py` – выборка и построение контекста для шаблона;
- `menus/templatetags/menu_tags.py` – реализация `{% draw_menu %}`;
- `menus/templates/...` – шаблоны меню;
- `templates/base.html` – пример подключения тега.

В демо-проекте используется SQLite (см. `DJANGO_DB_NAME`), однако в прод-версии предполагается PostgreSQL.
